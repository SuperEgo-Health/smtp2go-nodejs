/*!
 * 
 *   @smtp2go/smtp2go-api v0.0.1
 *   https://github.com/smtp2go/ts-library-boilerplate-basic
 *
 *   Copyright (c) SMTP2GO (https://github.com/smtp2go) and project contributors.
 *
 *   This source code is licensed under the MIT license found in the
 *   LICENSE file in the root directory of this source tree.
 *
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SMTP2GOAPI=t():e.SMTP2GOAPI=t()}(global,(function(){return(()=>{"use strict";var e={514:e=>{e.exports=require("mime-types")},147:e=>{e.exports=require("fs")},17:e=>{e.exports=require("path")}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};return(()=>{r.r(n),r.d(n,{ApiClient:()=>f,MailAttachment:()=>M,MailService:()=>R,Service:()=>m,default:()=>C});const e=require("@babel/runtime/helpers/asyncToGenerator");var t=r.n(e);const s=require("@babel/runtime/helpers/classCallCheck");var i=r.n(s);const a=require("@babel/runtime/helpers/createClass");var o=r.n(a);const u=require("@babel/runtime/helpers/defineProperty");var c=r.n(u);const h=require("@babel/runtime/regenerator");var l=r.n(h);const d=require("axios");var p=r.n(d),f=function(){function e(t){i()(this,e),c()(this,"apiUrl","https://api.smtp2go.com/v3/"),this.apiKey=t}var r;return o()(e,[{key:"setApiKey",value:function(e){this.apiKey=e}},{key:"consume",value:(r=t()(l().mark((function e(t){var r,n,s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.buildRequestBody();case 2:return(r=e.sent).api_key=this.apiKey,e.prev=4,e.next=7,p()({method:t.getMethod(),url:this.apiUrl+t.getEndpoint(),headers:{"Content-Type":"application/json"},data:r});case 7:return n=e.sent,s=n.data,e.abrupt("return",s);case 12:if(e.prev=12,e.t0=e.catch(4),!p().isAxiosError(e.t0)){e.next=19;break}return console.error(e.t0.message),e.abrupt("return",e.t0.response);case 19:return console.error(e.t0.message),e.abrupt("return",e.t0.response);case 21:case"end":return e.stop()}}),e,this,[[4,12]])}))),function(e){return r.apply(this,arguments)})}]),e}();const m=function(){function e(t,r,n){i()(this,e),this.endpoint=t,this.requestBody=r||new Map,this.method=n||"POST"}var r;return o()(e,[{key:"getMethod",value:function(){return this.method}},{key:"getEndpoint",value:function(){return this.endpoint}},{key:"buildRequestBody",value:(r=t()(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve(Object.fromEntries(this.requestBody));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})}]),e}(),y=require("@babel/runtime/helpers/toConsumableArray");var b=r.n(y);const v=require("@babel/runtime/helpers/get");var A=r.n(v);const x=require("@babel/runtime/helpers/inherits");var k=r.n(x);const q=require("@babel/runtime/helpers/possibleConstructorReturn");var g=r.n(q);const B=require("@babel/runtime/helpers/getPrototypeOf");var w=r.n(B),P=r(147).promises,j=r(514),S=r(17),M=function(){function e(t){i()(this,e),this.filepath=t,this.mimetype=j.lookup(this.filepath),this.filename=S.basename(this.filepath)}var r;return o()(e,[{key:"getFileBlob",value:(r=t()(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.readFile(this.filepath,{encoding:"base64"}).catch((function(e){throw e}));case 2:return this.fileblob=e.sent,e.abrupt("return",this.fileblob);case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"forSend",value:function(){return{filename:this.filename,fileblob:this.fileblob,mimetype:this.mimetype}}}]),e}();function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=w()(e);if(t){var s=w()(this).constructor;r=Reflect.construct(n,arguments,s)}else r=n.apply(this,arguments);return g()(this,r)}}var R=function(e){k()(s,e);var r,n=O(s);function s(){var e;return i()(this,s),e=n.call(this,"email/send"),["toAddress","ccAddress","bccAddress","customHeaders","attachments"].forEach((function(t){return e[t]=[]})),e}return o()(s,[{key:"addAddress",value:function(e,t){switch(t){case"cc":this.ccAddress.push(e);break;case"bcc":this.bccAddress.push(e);break;case"to":default:this.toAddress.push(e)}return this}},{key:"html",value:function(e){return this.htmlBody=e,this}},{key:"text",value:function(e){return this.textBody=e,this}},{key:"from",value:function(e){return this.fromAddress=e,this}},{key:"to",value:function(e){var t=this;return Array.isArray(e)?e.map((function(e){return t.addAddress(e,"to")})):this.addAddress(e,"to"),this}},{key:"headers",value:function(e){var t;Array.isArray(e)?(t=this.customHeaders).push.apply(t,b()(e)):this.customHeaders.push(e);return this}},{key:"subject",value:function(e){return this.subjectLine=e,this}},{key:"attach",value:function(e){if("string"==typeof e)this.attachments.push(new M(e));else if(Array.isArray(e)){var t;(t=this.attachments).push.apply(t,b()(e))}else this.attachments.push(e);return this}},{key:"getFormattedAddresses",value:function(e){switch(e){case"cc":return this.ccAddress.map(this.formatAddress);case"bcc":return this.bccAddress.map(this.formatAddress);case"to":default:return this.toAddress.map(this.formatAddress)}}},{key:"formatAddress",value:function(e){return e.name?"".concat(e.name," <").concat(e.email,">").trim():"<".concat(e.email,">").trim()}},{key:"buildRequestBody",value:(r=t()(l().mark((function e(){var t,r=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.requestBody=new Map,this.requestBody.set("html_body",this.htmlBody),this.requestBody.set("text_body",this.textBody||""),this.requestBody.set("to",this.getFormattedAddresses("to")),this.requestBody.set("sender",this.formatAddress(this.fromAddress)),this.requestBody.set("subject",this.subjectLine),!this.attachments.length){e.next=11;break}return t=[],this.attachments.forEach((function(e){t.push(e.getFileBlob())})),e.next=11,Promise.all(t).then((function(){r.requestBody.set("attachments",r.attachments.map((function(e){return e.forSend()})))}));case 11:return e.next=13,A()(w()(s.prototype),"buildRequestBody",this).call(this);case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})}]),s}(m);function C(e){return{service:function(e){return new m(e)},mail:function(){return new R},client:function(){return new f(e)}}}})(),n})()}));
//# sourceMappingURL=index.js.map